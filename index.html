<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ì‹¤ì‹œê°„ í™©ê¸ˆ í‚¤ì›Œë“œ ë¶„ì„ ë¦¬í¬íŠ¸">
    <title>í™©ê¸ˆ í‚¤ì›Œë“œ ìƒí™©ì‹¤</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
    <style>
        body { font-family: 'Pretendard', sans-serif; }
        .container { max-width: 1400px; }
        .badge { padding: 4px 8px; border-radius: 6px; font-size: 0.75em; font-weight: bold; color: white; vertical-align: middle; }
        .badge-naver { background-color: #03C75A; }
        .badge-coupang { background-color: #E60F29; }
        
        .grade-dia { color: #9C27B0; font-weight: 900; } 
        .grade-gold { color: #FF9800; font-weight: 800; } 
        .grade-silver { color: #607D8B; font-weight: 700; } 
        .grade-bad { color: #999; font-size: 0.9em; }

        .eff-good { color: #2e7d32; font-weight: bold; }
        .eff-bad { color: #d32f2f; }
        
        /* ìš”ì•½ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .summary-box { background-color: #f0f7ff; padding: 20px; border-radius: 10px; border: 1px solid #cce5ff; margin-bottom: 30px; line-height: 1.6; }
        .summary-title { color: #0056b3; margin-top: 0; margin-bottom: 10px; font-weight: bold; }
        
        th { font-weight: bold; background-color: #f4f4f4; white-space: nowrap; font-size: 0.9em; }
        td { vertical-align: middle; font-size: 0.95em; }
        .num-col { text-align: right; }
    </style>
</head>
<body>
    <main class="container">
        <nav>
            <ul><li><strong>ğŸ’ í™©ê¸ˆ í‚¤ì›Œë“œ ë°œêµ´ê¸°</strong></li></ul>
            <ul><li><small id="update-time">ë¶„ì„ ì¤‘...</small></li></ul>
        </nav>

        <!-- ìƒë‹¨ ìš”ì•½ -->
        <section id="top-briefing" class="summary-box" style="display:none;">
            <h3 class="summary-title">ğŸ“Š ì˜¤ëŠ˜ì˜ íŠ¸ë Œë“œ ìš”ì•½</h3>
            <p id="briefing-content"></p>
        </section>

        <section>
            <p><strong>ğŸ’¡ ê²½ìŸ ê°•ë„:</strong> (ë¸”ë¡œê·¸ ìˆ˜ Ã· ê²€ìƒ‰ëŸ‰). ìˆ˜ì¹˜ê°€ <strong>ğŸ”¥ 1.0 ë¯¸ë§Œ</strong>ì´ë©´ 'ë¸”ë£¨ì˜¤ì…˜'ì…ë‹ˆë‹¤.</p>
            <figure>
                <table role="grid">
                    <thead>
                        <tr>
                            <th scope="col" style="width: 8%;">ì¶œì²˜</th>
                            <th scope="col" style="width: 8%;">ìˆœìœ„</th>
                            <th scope="col">í‚¤ì›Œë“œ</th>
                            <th scope="col" class="num-col">í™©ê¸ˆì§€ìˆ˜</th>
                            <th scope="col" class="num-col">ê²½ìŸê°•ë„</th>
                            <th scope="col" class="num-col">ì›”ê°„ ê²€ìƒ‰ëŸ‰</th>
                            <th scope="col" class="num-col">ë¸”ë¡œê·¸ ìˆ˜</th>
                        </tr>
                    </thead>
                    <tbody id="keyword-list">
                        <tr><td colspan="7">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</td></tr>
                    </tbody>
                </table>
            </figure>
        </section>

        <!-- í•˜ë‹¨ ìš”ì•½ (ë™ì¼ ë‚´ìš©) -->
        <section id="bottom-briefing" class="summary-box" style="display:none; margin-top:30px;">
            <h3 class="summary-title">ğŸ“ ë¶„ì„ ìš”ì•½</h3>
            <p id="briefing-content-bottom"></p>
        </section>

        <section style="margin-top: 50px; border-top: 1px solid #eee; padding-top: 20px;">
            <h3>ğŸ—„ï¸ ì§€ë‚œ ë¦¬í¬íŠ¸ (ì•„ì¹´ì´ë¸Œ)</h3>
            <ul id="archive-list" style="list-style: none; padding: 0;"><li>ë¡œë”© ì¤‘...</li></ul>
        </section>
    </main>

    <script>
        // 5ë¬¸ì¥ ìƒì„± í•¨ìˆ˜
        function generateBriefingText(topItem) {
            const now = new Date();
            const dateStr = now.toLocaleDateString('ko-KR');
            const kw = topItem.keyword;
            const vol = topItem.search_volume.toLocaleString();
            const eff = topItem.efficiency;
            
            let status = "ë§¤ìš° ì–‘í˜¸(ë¸”ë£¨ì˜¤ì…˜)";
            let recommend = "ì§€ê¸ˆ ë°”ë¡œ ë¸”ë¡œê·¸ í¬ìŠ¤íŒ…ì´ë‚˜ ìƒí’ˆ ë“±ë¡ì„ ì¶”ì²œí•©ë‹ˆë‹¤.";
            
            if (eff > 5.0) {
                status = "ë‹¤ì†Œ ë†’ìŒ(ë ˆë“œì˜¤ì…˜)";
                recommend = "ê²½ìŸì´ ì¹˜ì—´í•˜ë¯€ë¡œ ì„¸ë¶€ í‚¤ì›Œë“œë¡œ ìš°íšŒí•˜ëŠ” ì „ëµì´ í•„ìš”í•©ë‹ˆë‹¤.";
            } else if (eff > 1.0) {
                status = "ë³´í†µ";
                recommend = "ì¶©ë¶„íˆ ì§„ì…í•´ë³¼ ë§Œí•œ ì‹œì¥ì…ë‹ˆë‹¤.";
            }

            return `
                1. <strong>${dateStr}</strong> ê¸°ì¤€, í˜„ì¬ ë°ì´í„°ë¥¼ ë¶„ì„í•œ ê²°ê³¼ ê°€ì¥ ê°€ì¹˜ ìˆëŠ” í‚¤ì›Œë“œëŠ” <span style="color:#d81b60; font-weight:bold;">'${kw}'</span>ì…ë‹ˆë‹¤.<br>
                2. ì´ í‚¤ì›Œë“œì˜ ì›”ê°„ ê²€ìƒ‰ëŸ‰ì€ ì•½ <strong>${vol}ê±´</strong>ìœ¼ë¡œ ìƒë‹¹íˆ ë†’ì€ ìˆ˜ìš”ë¥¼ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤.<br>
                3. ë°˜ë©´ ê²½ìŸ ê°•ë„(ë¸”ë¡œê·¸ ìˆ˜ ëŒ€ë¹„ ê²€ìƒ‰ëŸ‰)ëŠ” <strong>${eff}</strong> ìˆ˜ì¤€ìœ¼ë¡œ, ê²½ìŸ ìƒíƒœê°€ <strong>'${status}'</strong>ì…ë‹ˆë‹¤.<br>
                4. ë”°ë¼ì„œ ${recommend}<br>
                5. ì´ ë°ì´í„°ëŠ” ì‹¤ì‹œê°„ íŠ¸ë Œë“œë¥¼ ë°˜ì˜í•˜ë¯€ë¡œ, ë¹ ë¥´ê²Œ ì„ ì í•˜ì—¬ íŠ¸ë˜í”½ì„ í™•ë³´í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.
            `;
        }

        // 1. ë°ì´í„° ë¡œë”©
        fetch('output/data.json')
            .then(response => response.json())
            .then(data => {
                const tbody = document.getElementById('keyword-list');
                document.getElementById('update-time').innerText = "ìµœì¢… ì—…ë°ì´íŠ¸: " + new Date().toLocaleString('ko-KR');
                
                // [ìš”ì•½ ìƒì„±] ë°ì´í„°ê°€ ìˆì„ ë•Œë§Œ ì‹¤í–‰
                if (data && data.length > 0) {
                    const text = generateBriefingText(data[0]);
                    document.getElementById('briefing-content').innerHTML = text;
                    document.getElementById('briefing-content-bottom').innerHTML = text;
                    document.getElementById('top-briefing').style.display = 'block';
                    document.getElementById('bottom-briefing').style.display = 'block';
                }

                tbody.innerHTML = '';
                data.forEach(item => {
                    const tr = document.createElement('tr');
                    let badgeClass = item.source === 'COUPANG' ? 'badge-coupang' : 'badge-naver';
                    
                    let scoreHtml = `<span class="grade-bad">${item.golden_score}ì </span>`;
                    if (item.grade.includes("DIAMOND")) scoreHtml = `<span class="grade-dia">ğŸ’ ${item.golden_score}ì </span>`;
                    else if (item.grade.includes("GOLD")) scoreHtml = `<span class="grade-gold">ğŸŒŸ ${item.golden_score}ì </span>`;
                    
                    let effClass = '';
                    let effIcon = '';
                    let comp = item.efficiency;
                    if (comp === undefined) comp = 999.99; // ì•ˆì „ì¥ì¹˜

                    if (comp < 1.0) { effClass = 'eff-good'; effIcon = 'ğŸ”¥'; }
                    else if (comp > 5.0) { effClass = 'eff-bad'; effIcon = 'ğŸ’§'; }

                    tr.innerHTML = `
                        <td><span class="badge ${badgeClass}">${item.source}</span></td>
                        <td>${item.rank}</td>
                        <td><strong>${item.keyword}</strong><br><small style="color:#666;">${item.grade}</small></td>
                        <td class="num-col">${scoreHtml}</td>
                        <td class="num-col ${effClass}">${effIcon} ${comp}</td>
                        <td class="num-col"><strong>${item.search_volume.toLocaleString()}</strong></td>
                        <td class="num-col">${item.blog_count.toLocaleString()}</td>
                    `;
                    tbody.appendChild(tr);
                });
            })
            .catch(err => {
                console.error(err);
                document.getElementById('keyword-list').innerHTML = "<tr><td colspan='7'>ë°ì´í„° ë¡œë”© ì¤‘ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</td></tr>";
            });

        // 2. ì•„ì¹´ì´ë¸Œ ëª©ë¡
        fetch('output/archive_list.json')
            .then(res => res.json())
            .then(files => {
                const list = document.getElementById('archive-list');
                list.innerHTML = '';
                files.forEach(file => {
                    const name = file.replace('.html', '').replace('_', 'ì¼ ').replace('h', 'ì‹œ ë¦¬í¬íŠ¸');
                    const li = document.createElement('li');
                    // ì¼ë°˜ ë§í¬ (ìƒˆ ì°½ ì•„ë‹˜)
                    li.innerHTML = `<a href="output/archives/${file}">ğŸ“‚ ${name}</a>`;
                    list.appendChild(li);
                });
            });
    </script>
</body>
</html>
